\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{spelllist}[2015/02/02]

% Font Size
\DeclareOption{10pt}{
  \PassOptionsToClass{\CurrentOption}{article}
}
\DeclareOption{11pt}{
  \PassOptionsToClass{\CurrentOption}{article}
}
\DeclareOption{12pt}{
  \PassOptionsToClass{\CurrentOption}{article}
}

% Paper Size
\DeclareOption{a4paper}{
  \PassOptionsToClass{\CurrentOption}{article}
}
\DeclareOption{letterpaper}{
  \PassOptionsToClass{\CurrentOption}{article}
}

% Equation Alignment
\DeclareOption{fleqn}{
  \PassOptionsToClass{\CurrentOption}{article}
}
\DeclareOption{leqno}{
  \PassOptionsToClass{\CurrentOption}{article}
}

% Title page options
\DeclareOption{titlepage}{
  \PassOptionsToClass{\CurrentOption}{article}
}
\DeclareOption{notitlepage}{
  \PassOptionsToClass{\CurrentOption}{article}
}

% Draft mode
\DeclareOption{draft}{
  \PassOptionsToClass{\CurrentOption}{article}
}

% Fallback
\DeclareOption*{
  \ClassWarning{spelllist}{Unknown option '\CurrentOption'}
}

% Default options
\ExecuteOptions{}

% Process options
\ProcessOptions\relax

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Load Base Class %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\LoadClass[twocolumn]{article}

%%%%%%%%%%%%%%%%%%%%
%%%%% Packages %%%%%
%%%%%%%%%%%%%%%%%%%%
%\RequirePackage{geometry}
\RequirePackage{tikz}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Custom Commands %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
% These draw commands assume you are already in a tikzpicture
\newcommand\@drawverbal{
  \tikz[scale=0.7]{
    \draw [very thick] (0,0) ++(-30:0.1) arc (-30:30:0.1);
    \draw [very thick] (0,0) ++(-30:0.2) arc (-30:30:0.2);
    \draw [very thick] (0,0) ++(-30:0.3) arc (-30:30:0.3);
  } 
}
\newcommand\@drawsomatic{
  \tikz[scale=0.5]{
    \draw [semithick] (0,0)
          -- (0,0.2) arc (180:0:0.025) -- (0.05,0.1)
          -- (0.05,0.25) arc (180:0:0.025) -- (0.1,0.1)
          -- (0.1,0.275) arc (180:0:0.025) -- (0.15,0.1)
          -- (0.15,0.25) arc (180:0:0.025) -- (0.2,0.025)
          -- (0.2,0.15) arc (180:0:0.025) -- (0.25,0)
          .. controls (0.25,-0.15) and (0,-0.15) .. (0,0);
  }
  %\tikz[x=1ex,y=1ex]{
  %  \begin{scope}[shift={(0.2,0.2)}]
  %  \draw [thin,white] (0,0.1)
  %        -- (0,0.5) arc (180:0:0.05) -- (0.1,0.3)
  %        -- (0.1,0.6) arc (180:0:0.05) -- (0.2,0.3)
  %        -- (0.2,0.65) arc (180:0:0.05) -- (0.3,0.3)
  %        -- (0.3,0.6) arc (180:0:0.05) -- (0.4,0.15)
  %        -- (0.4,0.4) arc (180:0:0.05) -- (0.5,0.1)
  %        .. controls (0.5,-0.2) and (0,-0.2) .. (0,0.1);
  %  \end{scope}
  %  \draw[thin,white] (0,0) rectangle (1,1);
  %}
}
\newcommand\@drawdivinefocus{
  \tikz[scale=0.6]{
    \fill[white,rounded corners=1] (0.1,0) rectangle (0.2,0.4);
    \fill[white,rounded corners=1] (0,0.3) rectangle (0.3,0.2);
  }
}
\newcommand\@drawfocus{
  \tikz{
    \filldraw[white] (0,0) circle [radius=0.025];
    \draw[white,very thick] (0,0) circle [radius=0.1];
  }
}
\newcommand\@drawmaterial{
  \tikz[scale=0.6]{
    %\path[draw=white,use as bounding box]
    \begin{scope}
    \draw[white,semithick] (0,0) -- (0.2,-0.2) .. controls (0.3,-0.3) and (0.4,-0.2) .. (0.3,-0.1) -- (0.1,0.1);
    \filldraw[white] (0.1,-0.1) -- (0.3,-0.1) .. controls (0.4,-0.2) and (0.3,-0.3) .. (0.2,-0.2) -- cycle;
    \end{scope}
  }
}

\newcommand\@drawluck{
  \tikz[scale=0.25]{
    \path[draw=white,use as bounding box] (-0.4,-0.5) rectangle (0.4,0.3);
    \draw[white,line width=1,cap=round] (-0.2,0.2) .. controls (-0.6,-0.6) and (0.6,-0.6) .. (0.2,0.2);
  }
}
\newcommand\@drawtravel{
  \tikz[x=1ex,y=1ex]{
    %\draw[white,semithick] (0,0) -- (0.05,0) -- (0.05,0.025) -- (0.1,0) -- (0.2,0) .. controls (0.2,0.025) .. (0.15,0.05) -- (0.075,0.1) -- (0.075,0.125) -- (0,0.125) -- cycle;
    %\draw[white,semithick,rounded corners=0.25] (0,-0.05) -- (0.075,-0.05) -- (0.075,-0.025) .. controls (0.075,-0.03) and (0.15,-0.05) .. (0.175,-0.05) -- (0.25,-0.05) -- (0.25,0) -- (0,0) -- cycle;
    
    %\filldraw[white,semithick,rounded corners=0.25] (0,-0.025) -- (0.075,-0.025) -- (0.075,-0.0125) to [out=330,in=180] (0.175,-0.025) -- (0.25,-0.025) -- (0.25,0) -- (0,0) -- cycle;
    %\draw[white,semithick,rounded corners=0.25] (0,-0.025) to [out=90,in=250] (0.0125,0.075);
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Custom Environments %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand\@typesetspell{
  \par\noindent\begin{tikzpicture}
    \node [text width=0.97\linewidth,fill=gray,text=white] (title) at (0,0)
    {
      \textsc{\@spellname}
      \hfill
      \if@luck\@drawluck\fi
      \if@travel\@drawtravel\fi
      \hspace{2ex}
      \if@verbal\@drawverbal\fi
      \if@somatic\@drawsomatic\fi
      \if@divinefocus\@drawdivinefocus\fi
      \if@focus\@drawfocus\fi
      \if@material\@drawmaterial\fi
    };
  \end{tikzpicture}
  
  \vspace{-2.5ex}
  \begin{flushleft}
    \noindent\textbf{School} \@spellschool
    
    \if@castingtime
      \noindent\textbf{Casting Time} \@castingtime
    \fi
    
    \noindent\textbf{Components}
    \if@verbal{} V\fi
    \if@somatic{} S\fi
    \if@divinefocus{} DF\fi
    \if@material{} M (\@material)\fi
    \if@focus{} F (\@focus)\fi
    
    \if@castingrange
      \noindent\textbf{Range} \@castingrange
    \fi
    
    \if@spellarea
      \noindent\textbf{Area} \@spellarea
    \fi
    
    \if@spelleffect
      \noindent\textbf{Effect} \@spelleffect
    \fi
    
    \if@spelltarget
      \noindent\textbf{Target} \@spelltarget
    \fi
    
    \if@spellduration
      \noindent\textbf{Duration} \@spellduration
    \fi
    
    \if@savingthrow
      \noindent\textbf{Saving Throw} \@savingthrow
    \fi
    
    \if@spellresist
      \noindent\textbf{Spell Resist} \@spellresist
    \fi
  \end{flushleft}
  \vspace{-2ex}
  
  \@description
}

\newenvironment{spell} 
  {
    % Spell information
    \newcommand\@spellname{}
    \newcommand\spellname[1]{\renewcommand\@spellname{##1}}
    
    \newcommand\@spellschool{}
    \newcommand\spellschool[1]{\renewcommand\@spellschool{##1}}
    
    \newif\if@castingtime
    \newcommand\@castingtime{}
    \newcommand\castingtime[1]{\renewcommand\@castingtime{##1}\@castingtimetrue}
    \newcommand\oneaction{1 standard action}
    \newcommand\oneround{1 round}
    
    \newif\if@castingrange
    \newcommand\@castingrange{}
    \newcommand\castingrange[1]
      {\renewcommand\@castingrange{##1}\@castingrangetrue}
    \newcommand\shortrange{close (25~ft. + 5 ft./2 levels)}
    \newcommand\mediumrange{medium (100~ft. + 10 ft./level)}
    \newcommand\longrange{long (400~ft. + 40 ft./level)}
    
    \newif\if@spellarea
    \newcommand\@spellarea{}
    \newcommand\spellarea[1]
      {\renewcommand\@spellarea{##1}\@spellareatrue}
    
    \newif\if@spelleffect
    \newcommand\@spelleffect{}
    \newcommand\spelleffect[1]
      {\renewcommand\@spelleffect{##1}\@spelleffecttrue}
    
    \newif\if@spelltarget
    \newcommand\@spelltarget{}
    \newcommand\spelltarget[1]{\renewcommand\@spelltarget{##1}\@spelltargettrue}
    
    \newif\if@spellduration
    \newcommand\@spellduration{}
    \newcommand\spellduration[1]
      {\renewcommand\@spellduration{##1}\@spelldurationtrue}
    
    \newif\if@savingthrow
    \newcommand\@savingthrow{}
    \newcommand\savingthrow[1]{\renewcommand\@savingthrow{##1}\@savingthrowtrue}
    
    \newif\if@spellresist
    \newcommand\@spellresist{}
    \newcommand\resistno{\renewcommand\@spellresist{No}\@spellresisttrue}
    \newcommand\resistyes{\renewcommand\@spellresist{Yes}\@spellresisttrue}
    
    \newcommand\@description{}
    \newcommand\spelldescription[1]{\renewcommand\@description{##1}}
    
    % Spell components
    \newif\if@verbal
    \newcommand\verbal\@verbaltrue
    \newif\if@somatic
    \newcommand\somatic\@somatictrue
    \newif\if@divinefocus
    \newcommand\divinefocus\@divinefocustrue
    \newif\if@material
    \newcommand\@material{}
    \newcommand\material[1]{\renewcommand\@material{##1}\@materialtrue}
    \newif\if@focus
    \newcommand\@focus{}
    \newcommand\focus[1]{\renewcommand\@focus{##1}\@focustrue}
    
    % Spell domains
    \newif\if@luck
    \newcommand\luck\@lucktrue
    \newif\if@travel
    \newcommand\travel\@traveltrue
  }
  {\noindent\@typesetspell}
